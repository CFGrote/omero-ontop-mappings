* Dataset with annotations
:PROPERTIES:
:ID:       c97f7deb-8163-4c3d-9c8f-ed50b3e36552
:END:
#+begin_src sparql :url http://localhost:8080/sparql
  PREFIX : <https://www.openmicroscopy.org/omemap/>
  PREFIX owl: <http://www.w3.org/2002/07/owl#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX xml: <http://www.w3.org/XML/1998/namespace>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  PREFIX obda: <https://w3id.org/obda/vocabulary#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX omemap: <https://www.openmicroscopy.org/omemap#>
  PREFIX ome_core: <http://www.openmicroscopy.org/rdf/2016-06/ome_core/>

  select * where {
  ?ant a ome_core:Annotation ;
          rdfs:comment ?cmnt .
  ?ds a ome_core:Dataset ;
         ome_core:annotation ?ant .
  }
  limit 10
#+end_src

#+RESULTS:
| ant                                                                | cmnt                    | ds                                                             |
|--------------------------------------------------------------------+-------------------------+----------------------------------------------------------------|
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Annotation/3222 | pseudomonas fluorescens | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/602 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Annotation/3219 | mat formation           | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/712 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Annotation/3221 | mirror                  | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/709 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Annotation/3217 | AxioZoom                | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/602 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Annotation/3218 | darkfield               | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/703 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Annotation/3221 | mirror                  | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/603 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Annotation/3224 | upright                 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/752 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Annotation/3220 | microscopy              | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/707 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Annotation/2106 | Lateral                 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/606 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Annotation/2105 | Top                     | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/603 |

* Project with datasets
:PROPERTIES:
:ID:       9114c7b4-6367-43f6-a8d2-9583999e554f
:END:
#+begin_src sparql :url http://localhost:8080/sparql
  PREFIX : <https://www.openmicroscopy.org/omemap/>
  PREFIX owl: <http://www.w3.org/2002/07/owl#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX xml: <http://www.w3.org/XML/1998/namespace>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  PREFIX obda: <https://w3id.org/obda/vocabulary#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX omemap: <https://www.openmicroscopy.org/omemap#>
  PREFIX ome_core: <http://www.openmicroscopy.org/rdf/2016-06/ome_core/>

  select * where {
  ?proj a ome_core:Project ;
           rdfs:label ?lbl .
  ?ds a ome_core:Dataset .
  ?proj ome_core:dataset ?ds .
  }
limit 20
#+end_src

#+RESULTS:
| proj                                                            | lbl                                                  | ds                                                              |
|-----------------------------------------------------------------+------------------------------------------------------+-----------------------------------------------------------------|
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/211  | Biofilm chamber                                      | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/638  |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/211  | Biofilm chamber                                      | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/637  |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/955  | MICROCOLONY TIMELAPSES                               | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/2951 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/955  | MICROCOLONY TIMELAPSES                               | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/990  |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/207  | Imaging for Michael Barnett                          | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/707  |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/968  | ChemiDoc                                             | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/2385 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/215  | Chemotaxis and Capillary experiments                 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/654  |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/207  | Imaging for Michael Barnett                          | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/1058 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/955  | MICROCOLONY TIMELAPSES                               | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/1003 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/1206 | Omero training                                       | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/4010 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/955  | MICROCOLONY TIMELAPSES                               | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/624  |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/215  | Chemotaxis and Capillary experiments                 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/785  |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/301  | Test 100x Phase contrast objective with PSA 13/07/20 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/751  |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/965  | Measuring signal increases                           | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/3176 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/1206 | Omero training                                       | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/4025 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/968  | ChemiDoc                                             | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/2383 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/1301 | Joanna Summers processing                            | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/4517 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/955  | MICROCOLONY TIMELAPSES                               | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/1233 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/1301 | Joanna Summers processing                            | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/4519 |
| http://www.openmicroscopy.org/rdf/2016-06/ome_core/Project/955  | MICROCOLONY TIMELAPSES                               | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Dataset/777  |




* Dataset with image and annotations
:PROPERTIES:
:ID:       6a7df85e-c217-45f5-8d79-9eed4f71eff2
:END:
#+begin_src sparql :url http://localhost:8080/sparql
  PREFIX : <https://www.openmicroscopy.org/omemap/>
  PREFIX owl: <http://www.w3.org/2002/07/owl#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX xml: <http://www.w3.org/XML/1998/namespace>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  PREFIX obda: <https://w3id.org/obda/vocabulary#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX omemap: <https://www.openmicroscopy.org/omemap#>
  PREFIX ome_core: <http://www.openmicroscopy.org/rdf/2016-06/ome_core/>

  select * where {
    ?ds a ome_core:Dataset.
    ?img a ome_core:Image.
    ?ds ome_core:image ?img .
    ?img rdfs:label ?name ;
    ome_core:annotation ?img_ant .
    ?img_ant ome_core:mapAnnotationValue/ome_core:key ?key .
    ?img_ant ome_core:mapAnnotationValue/ome_core:value ?val .
  }
  limit 10
#+end_src

#+RESULTS:
| ds | img | name | img_ant | key | val |
|----+-----+------+---------+-----+-----|

* Fixed image and annotations
:PROPERTIES:
:ID:       9500a96c-a3ff-4f3b-9890-ca2fbf320f74
:END:
#+begin_src sparql :url http://localhost:8080/sparql
  
PREFIX : <https://www.openmicroscopy.org/omemap/>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xml: <http://www.w3.org/XML/1998/namespace>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX obda: <https://w3id.org/obda/vocabulary#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX omemap: <https://www.openmicroscopy.org/omemap#>
PREFIX ome_core: <http://www.openmicroscopy.org/rdf/2016-06/ome_core/>
PREFIX ome_instance: <https://ome.evolbio.mpg.de/api/v0/m/>
prefix ome_instance_annotation: <https://ome.evolbio.mpg.de/api/v0/m/Annotation/>

select * where {
?img ome_core:annotation ome_instance_annotation:2 .
ome_instance_annotation:2 ome_core:mapAnnotationValue ?mav .
?mav ?p ?o .

}
limit 10


#+end_src

#+RESULTS:
| img                                            | mav                                         | p                                                        | o                                                      |
|------------------------------------------------+---------------------------------------------+----------------------------------------------------------+--------------------------------------------------------|
| https://ome.evolbio.mpg.de/api/v0/m/Image/1523 | https://ome.evolbio.mpg.de/api/v0/m/Map/2/0 | http://www.w3.org/1999/02/22-rdf-syntax-ns#type          | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Map |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1523 | https://ome.evolbio.mpg.de/api/v0/m/Map/2/0 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/value | sbw25                                                  |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1523 | https://ome.evolbio.mpg.de/api/v0/m/Map/2/0 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/key   | strain                                                 |

* var image and annotations
:PROPERTIES:
:ID:       9500a96c-a3ff-4f3b-9890-ca2fbf320f74
:END:
#+begin_src sparql :url http://localhost:8080/sparql
  
  PREFIX : <https://www.openmicroscopy.org/omemap/>
  PREFIX owl: <http://www.w3.org/2002/07/owl#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX xml: <http://www.w3.org/XML/1998/namespace>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  PREFIX obda: <https://w3id.org/obda/vocabulary#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX omemap: <https://www.openmicroscopy.org/omemap#>
  PREFIX ome_core: <http://www.openmicroscopy.org/rdf/2016-06/ome_core/>
  PREFIX ome_instance: <https://ome.evolbio.mpg.de/api/v0/m/>
  prefix ome_instance_annotation: <https://ome.evolbio.mpg.de/api/v0/m/Annotation/>

  select * where {
  ?img a ome_core:Image .
  ?img ome_core:annotation ?anno .
  ?anno ome_core:mapAnnotationValue ?mav .
  ?mav ?p ?o .

  }
  limit 10


#+end_src

#+RESULTS:
| img                                            | anno                                               | mav                                           | p                                                        | o                                                      |
|------------------------------------------------+----------------------------------------------------+-----------------------------------------------+----------------------------------------------------------+--------------------------------------------------------|
| https://ome.evolbio.mpg.de/api/v0/m/Image/1523 | https://ome.evolbio.mpg.de/api/v0/m/Annotation/2   | https://ome.evolbio.mpg.de/api/v0/m/Map/2/0   | http://www.w3.org/1999/02/22-rdf-syntax-ns#type          | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Map |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1523 | https://ome.evolbio.mpg.de/api/v0/m/Annotation/2   | https://ome.evolbio.mpg.de/api/v0/m/Map/2/0   | http://www.openmicroscopy.org/rdf/2016-06/ome_core/value | sbw25                                                  |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1523 | https://ome.evolbio.mpg.de/api/v0/m/Annotation/2   | https://ome.evolbio.mpg.de/api/v0/m/Map/2/0   | http://www.openmicroscopy.org/rdf/2016-06/ome_core/key   | strain                                                 |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1624 | https://ome.evolbio.mpg.de/api/v0/m/Annotation/222 | https://ome.evolbio.mpg.de/api/v0/m/Map/222/0 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/value | 0                                                      |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1624 | https://ome.evolbio.mpg.de/api/v0/m/Annotation/222 | https://ome.evolbio.mpg.de/api/v0/m/Map/222/0 | http://www.w3.org/1999/02/22-rdf-syntax-ns#type          | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Map |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1624 | https://ome.evolbio.mpg.de/api/v0/m/Annotation/222 | https://ome.evolbio.mpg.de/api/v0/m/Map/222/0 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/key   | Position                                               |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1625 | https://ome.evolbio.mpg.de/api/v0/m/Annotation/223 | https://ome.evolbio.mpg.de/api/v0/m/Map/223/0 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/value | 0                                                      |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1625 | https://ome.evolbio.mpg.de/api/v0/m/Annotation/223 | https://ome.evolbio.mpg.de/api/v0/m/Map/223/0 | http://www.w3.org/1999/02/22-rdf-syntax-ns#type          | http://www.openmicroscopy.org/rdf/2016-06/ome_core/Map |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1625 | https://ome.evolbio.mpg.de/api/v0/m/Annotation/223 | https://ome.evolbio.mpg.de/api/v0/m/Map/223/0 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/key   | Position                                               |
| https://ome.evolbio.mpg.de/api/v0/m/Image/1626 | https://ome.evolbio.mpg.de/api/v0/m/Annotation/224 | https://ome.evolbio.mpg.de/api/v0/m/Map/224/0 | http://www.openmicroscopy.org/rdf/2016-06/ome_core/value | 0                                                      |

* Construct new triples as <img> <key> <val>.
:PROPERTIES:
:ID:       b02c886d-4def-4d2a-86a8-608a5aa12ba3
:END:
#+begin_src sparql :url http://localhost:8080/sparql

    PREFIX : <https://www.openmicroscopy.org/omemap/>
    PREFIX owl: <http://www.w3.org/2002/07/owl#>
    PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
    PREFIX xml: <http://www.w3.org/XML/1998/namespace>
    PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
    PREFIX obda: <https://w3id.org/obda/vocabulary#>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    PREFIX omemap: <https://www.openmicroscopy.org/omemap#>
    PREFIX ome_core: <http://www.openmicroscopy.org/rdf/2016-06/ome_core/>
    PREFIX ome_instance: <https://ome.evolbio.mpg.de/api/v0/m/>
    prefix ome_instance_annotation: <https://ome.evolbio.mpg.de/api/v0/m/Annotation/>


construct {
  ?key a rdf:Property .
  ?img ?key ?val .
    }
  where {
    ?img a ome_core:Image;
         ome_core:annotation ?annotation .
    ?annotation ome_core:mapAnnotationValue ?map .
    ?map ome_core:key ?keystr;
         ome_core:value ?val .
  bind(iri(concat("https://www.openmicroscopy.org/omemap#",str(?keystr))) as ?key)
    }
  limit 10
  #+end_src

#+RESULTS:
| HTTP/1.1 406               |                          |
|----------------------------+--------------------------|
| Transfer-Encoding: chunked |                          |
| Date: Thu                  | 10 Oct 2024 12:13:18 GMT |
| Keep-Alive: timeout=60     |                          |
| Connection: keep-alive     |                          |
